# ç›—ç‰ˆæ£€æµ‹åŠäº¤äº’ä»»åŠ¡Agentç³»ç»Ÿ

åŸºäºAIå¤§æ¨¡å‹çš„æ‰‹æœºè‡ªåŠ¨åŒ–æ“æ§æ¡†æ¶ï¼Œå®ç°åœ¨é—²é±¼/å°çº¢ä¹¦ç­‰å¹³å°è‡ªåŠ¨æ£€æµ‹å’Œä¸¾æŠ¥ç›—ç‰ˆ"å¾—åˆ°"Appå†…å®¹ã€‚

åŒæ—¶ä¹Ÿèƒ½å®ç°ç›¸å…³å¼€æ”¾å¼ä»»åŠ¡ã€‚

## ç³»ç»Ÿæ¶æ„

```mermaid
flowchart TB
    subgraph ç”¨æˆ·å±‚
        A[ç”¨æˆ·] --> B[å‘½ä»¤è¡Œç•Œé¢]
    end
    
    subgraph åº”ç”¨å±‚
        B --> C[dedao_piracy_detector.py<br/>ç›—ç‰ˆæ£€æµ‹ä¸»ç¨‹åº]
        B --> D[run_agent.py<br/>äº¤äº’å¼æ“æ§ç¨‹åº]
    end
    
    subgraph Agentå±‚
        C --> E[PiracyDetector<br/>ç›—ç‰ˆæ£€æµ‹Agent]
        D --> F[PhoneAgent<br/>æ‰‹æœºæ“æ§Agent]
        E --> F
        
        subgraph åŒAgentæ¶æ„
            G[Agent1: DeepSeek<br/>ä»»åŠ¡åˆ†è§£ä¸æç¤ºè¯ç”Ÿæˆ]
            H[Agent2: AutoGLM<br/>æ‰‹æœºæ“æ§æ‰§è¡Œ]
            G --> H
        end
        F --> G
        F --> H
    end
    
    subgraph æ ¸å¿ƒæ¨¡å—
        F --> I[ModelClient<br/>æ¨¡å‹å®¢æˆ·ç«¯]
        F --> J[ActionHandler<br/>åŠ¨ä½œå¤„ç†å™¨]
        F --> K[ContentAnalyzer<br/>å†…å®¹åˆ†æå™¨]
    end
    
    subgraph ADBé€šä¿¡å±‚
        J --> L[ADBæ¨¡å—]
        L --> M[screenshot.py<br/>æˆªå›¾]
        L --> N[device.py<br/>è®¾å¤‡æ§åˆ¶]
        L --> O[input.py<br/>æ–‡æœ¬è¾“å…¥]
        L --> P[connection.py<br/>è¿æ¥ç®¡ç†]
    end
    
    subgraph è®¾å¤‡å±‚
        M --> Q[Androidæ¨¡æ‹Ÿå™¨/æ‰‹æœº]
        N --> Q
        O --> Q
        P --> Q
    end
    
    subgraph å¤–éƒ¨API
        I --> R[AutoGLM API<br/>æ™ºè°±AI]
        G --> S[DeepSeek API]
    end
```

## åŠŸèƒ½æ¦‚è¿°

### æ ¸å¿ƒåŠŸèƒ½

| åŠŸèƒ½æ¨¡å— | æè¿° |
|---------|------|
| **ç›—ç‰ˆæ£€æµ‹** | è‡ªåŠ¨åœ¨é—²é±¼/å°çº¢ä¹¦æœç´¢ç–‘ä¼¼ç›—ç‰ˆå•†å“ï¼Œé€šè¿‡å¤šæ¨¡æ€åˆ†æè¯†åˆ«ç›—ç‰ˆç‰¹å¾ |
| **æ™ºèƒ½æ“æ§** | åŸºäºè§†è§‰è¯­è¨€æ¨¡å‹(VLM)ç†è§£æ‰‹æœºå±å¹•å†…å®¹å¹¶æ‰§è¡Œæ“ä½œ |
| **è‡ªåŠ¨ä¸¾æŠ¥** | æ£€æµ‹åˆ°é«˜ç½®ä¿¡åº¦ç›—ç‰ˆå†…å®¹åè‡ªåŠ¨æ‰§è¡Œä¸¾æŠ¥æµç¨‹ |
| **äº¤äº’å¼æ§åˆ¶** | æ”¯æŒç”¨æˆ·è¾“å…¥è‡ªç„¶è¯­è¨€ä»»åŠ¡ï¼ŒAgentè‡ªåŠ¨æ‰§è¡Œ |

### åŒAgentåä½œæœºåˆ¶

```mermaid
sequenceDiagram
    participant U as ç”¨æˆ·
    participant A1 as Agent1<br/>(DeepSeek)
    participant A2 as Agent2<br/>(AutoGLM)
    participant P as æ‰‹æœºè®¾å¤‡
    
    U->>A1: è¾“å…¥ä»»åŠ¡æè¿°
    A1->>A1: åˆ†æä»»åŠ¡éœ€æ±‚
    A1->>A2: ç”Ÿæˆæ‰§è¡Œæç¤ºè¯
    
    loop ä»»åŠ¡æ‰§è¡Œå¾ªç¯
        P->>A2: æˆªå–å±å¹•
        A2->>A2: åˆ†æå±å¹•å†…å®¹
        A2->>A2: å†³ç­–ä¸‹ä¸€æ­¥æ“ä½œ
        A2->>P: æ‰§è¡Œæ“ä½œ(ç‚¹å‡»/æ»‘åŠ¨/è¾“å…¥ç­‰)
    end
    
    A2->>U: è¿”å›æ‰§è¡Œç»“æœ
```

## ç›®å½•ç»“æ„

```
bohack-project/
â”œâ”€â”€ dedao_piracy_detector.py   # ç›—ç‰ˆæ£€æµ‹ä¸»ç¨‹åºå…¥å£
â”œâ”€â”€ run_agent.py               # äº¤äº’å¼æ‰‹æœºæ“æ§å…¥å£
â”œâ”€â”€ requirements.txt           # Pythonä¾èµ–
â”‚
â””â”€â”€ phone_agent/               # æ ¸å¿ƒæ¡†æ¶åŒ…
    â”œâ”€â”€ __init__.py            # åŒ…å…¥å£ï¼Œå¯¼å‡ºPhoneAgent
    â”œâ”€â”€ agent.py               # PhoneAgentä¸»ç±»ï¼Œä»»åŠ¡æ‰§è¡Œå¾ªç¯
    â”‚
    â”œâ”€â”€ model/                 # æ¨¡å‹å®¢æˆ·ç«¯
    â”‚   â”œâ”€â”€ __init__.py
    â”‚   â””â”€â”€ client.py          # OpenAIå…¼å®¹APIå®¢æˆ·ç«¯ï¼Œæ¶ˆæ¯æ„å»ºå™¨
    â”‚
    â”œâ”€â”€ actions/               # åŠ¨ä½œå¤„ç†
    â”‚   â”œâ”€â”€ __init__.py
    â”‚   â””â”€â”€ handler.py         # åŠ¨ä½œè§£æä¸æ‰§è¡Œ(ç‚¹å‡»/æ»‘åŠ¨/è¾“å…¥ç­‰)
    â”‚
    â”œâ”€â”€ adb/                   # ADBé€šä¿¡å±‚
    â”‚   â”œâ”€â”€ __init__.py        # ç»Ÿä¸€å¯¼å‡ºæ¥å£
    â”‚   â”œâ”€â”€ screenshot.py      # æˆªå›¾åŠŸèƒ½
    â”‚   â”œâ”€â”€ device.py          # è®¾å¤‡æ§åˆ¶(ç‚¹å‡»/æ»‘åŠ¨/å¯åŠ¨Appç­‰)
    â”‚   â”œâ”€â”€ input.py           # æ–‡æœ¬è¾“å…¥(ADBé”®ç›˜)
    â”‚   â””â”€â”€ connection.py      # è®¾å¤‡è¿æ¥ç®¡ç†
    â”‚
    â””â”€â”€ config/                # é…ç½®ä¸æç¤ºè¯
        â”œâ”€â”€ __init__.py
        â”œâ”€â”€ prompts_zh.py      # Agent2ä¸­æ–‡ç³»ç»Ÿæç¤ºè¯
        â”œâ”€â”€ prompts_piracy.py  # Agent1æç¤ºè¯ç”Ÿæˆå™¨
        â”œâ”€â”€ apps.py            # AppåŒ…åæ˜ å°„
        â”œâ”€â”€ i18n.py            # å›½é™…åŒ–æ¶ˆæ¯
        â””â”€â”€ timing.py          # æ“ä½œå»¶æ—¶é…ç½®
```

## ç›—ç‰ˆæ£€æµ‹æµç¨‹

```mermaid
flowchart LR
    subgraph ç¬¬ä¸€æ­¥
        A[å¯åŠ¨å¾—åˆ°App] --> B[æœç´¢ç›®æ ‡å†…å®¹]
        B --> C[ç¡®è®¤æ­£ç‰ˆä¿¡æ¯]
    end
    
    subgraph ç¬¬äºŒæ­¥
        C --> D[å¯åŠ¨ç›®æ ‡å¹³å°<br/>é—²é±¼/å°çº¢ä¹¦]
        D --> E[æœç´¢å…³é”®è¯]
        E --> F{å¹³å°ç±»å‹?}
        F -->|å°çº¢ä¹¦| G[ç‚¹å‡»å•†å“æ ‡ç­¾ç­›é€‰]
        F -->|é—²é±¼| H[ç›´æ¥æœç´¢ç»“æœ]
    end
    
    subgraph ç¬¬ä¸‰æ­¥[å¾ªç¯æ£€æµ‹]
        G --> I[è¿›å…¥å•†å“è¯¦æƒ…]
        H --> I
        I --> J[æˆªå›¾åˆ†æ]
        J --> K{ç›—ç‰ˆåˆ¤å®š}
        K -->|æ˜¯| L[è‡ªåŠ¨ä¸¾æŠ¥]
        K -->|å¦| M[è·³è¿‡]
        L --> N{è¿˜æœ‰æ›´å¤š?}
        M --> N
        N -->|æ˜¯| O[ä¸‹ä¸€ä¸ªå•†å“]
        O --> I
        N -->|å¦| P[ç”ŸæˆæŠ¥å‘Š]
    end
```

## ç¯å¢ƒé…ç½®

### ç³»ç»Ÿè¦æ±‚

- Python 3.10+
- ADB (Android Debug Bridge)
- Androidæ¨¡æ‹Ÿå™¨ æˆ– å·²å¼€å¯USBè°ƒè¯•çš„Androidæ‰‹æœº

### å®‰è£…ä¾èµ–

```bash
pip install -r requirements.txt
```

### ADBç¯å¢ƒé…ç½®

1. **å®‰è£…ADBå·¥å…·**
   - Windows: ä¸‹è½½Android SDK Platform Toolså¹¶æ·»åŠ åˆ°PATH
   - macOS: `brew install android-platform-tools`
   - Linux: `sudo apt install adb`

2. **è¿æ¥è®¾å¤‡**
   ```bash
   # æ¨¡æ‹Ÿå™¨è¿æ¥(ä»¥MuMuä¸ºä¾‹)
   adb connect 127.0.0.1:5555
   
   # æŸ¥çœ‹å·²è¿æ¥è®¾å¤‡
   adb devices
   ```

3. **å®‰è£…ADBé”®ç›˜**(å¯é€‰ï¼Œç”¨äºä¸­æ–‡è¾“å…¥)
   ```bash
   adb install ADBKeyboard.apk
   ```

### APIé…ç½®

ç¨‹åºé»˜è®¤ä½¿ç”¨æ™ºè°±AIçš„AutoGLMæ¨¡å‹ï¼Œéœ€é…ç½®APIï¼š

| å‚æ•° | é»˜è®¤å€¼ | è¯´æ˜ |
|------|--------|------|
| `--base-url` | `https://open.bigmodel.cn/api/paas/v4` | AutoGLM APIåœ°å€ |
| `--model` | `autoglm-phone` | æ¨¡å‹åç§° |
| `--apikey` | `EMPTY` | API Key |
| `--deepseek-key` | - | DeepSeek API Key(Agent1) |

## ä½¿ç”¨æ–¹æ³•

### ç›—ç‰ˆæ£€æµ‹æ¨¡å¼

```bash
# åŸºæœ¬ç”¨æ³• - äº¤äº’å¼é€‰æ‹©å¹³å°
python dedao_piracy_detector.py

# æŒ‡å®šå¹³å°å’Œå…³é”®è¯
python dedao_piracy_detector.py --platform xianyu --keyword "è–›å…†ä¸°ç»æµå­¦"

# æŒ‡å®šæ£€æµ‹æ•°é‡å’Œè‡ªåŠ¨ä¸¾æŠ¥
python dedao_piracy_detector.py --platform xiaohongshu --max-items 20 --auto-report

# å®Œæ•´å‚æ•°ç¤ºä¾‹
python dedao_piracy_detector.py \
    --platform xianyu \
    --keyword "å¾—åˆ°ç”µå­ä¹¦" \
    --max-items 15 \
    --base-url "https://open.bigmodel.cn/api/paas/v4" \
    --model "autoglm-phone" \
    --apikey "your-api-key" \
    --connect 127.0.0.1:7555 \
    --auto-report
```

### äº¤äº’å¼æ“æ§æ¨¡å¼

```bash
# å¯åŠ¨äº¤äº’å¼Agent
python run_agent.py

# æŒ‡å®šè®¾å¤‡è¿æ¥
python run_agent.py --connect 127.0.0.1:7555

# æŒ‡å®šDeepSeek API Key
python run_agent.py --deepseek-key "your-deepseek-key"
```

**äº¤äº’ç¤ºä¾‹ï¼š**
```
ğŸ“ è¯·è¾“å…¥è¦å®Œæˆçš„ä»»åŠ¡: æ‰“å¼€æ·˜å®æœç´¢iPhoneæ‰‹æœºå£³
ğŸ“± ç›®æ ‡å¹³å°(å¯é€‰ï¼Œç›´æ¥å›è½¦è·³è¿‡): æ·˜å®

ğŸ¤– Agent1 (DeepSeek) æ­£åœ¨ç”Ÿæˆæç¤ºè¯...
ğŸ“ DeepSeek ç”Ÿæˆçš„ä»»åŠ¡æç¤ºè¯:
...
ğŸš€ Agent2 (AutoGLM) å¼€å§‹æ‰§è¡Œä»»åŠ¡...
```

### å‘½ä»¤è¡Œå‚æ•°è¯´æ˜

| å‚æ•° | ç®€å†™ | è¯´æ˜ | é»˜è®¤å€¼ |
|------|------|------|--------|
| `--platform` | - | ç›®æ ‡å¹³å°: xianyu/xiaohongshu | äº¤äº’é€‰æ‹© |
| `--keyword` | `-k` | æœç´¢å…³é”®è¯ | è–›å…†ä¸°æ¼«ç”»ç»æµå­¦ |
| `--max-items` | - | æœ€å¤§æ£€æµ‹å•†å“æ•° | 10 |
| `--auto-report` | - | è‡ªåŠ¨ä¸¾æŠ¥é«˜ç½®ä¿¡åº¦ç›—ç‰ˆ | False |
| `--base-url` | - | æ¨¡å‹APIåœ°å€ | æ™ºè°±AI |
| `--model` | - | æ¨¡å‹åç§° | autoglm-phone |
| `--apikey` | - | APIå¯†é’¥ | EMPTY |
| `--device-id` | `-d` | ADBè®¾å¤‡ID | è‡ªåŠ¨æ£€æµ‹ |
| `--connect` | `-c` | è¿æ¥è®¾å¤‡åœ°å€ | - |

## ç›—ç‰ˆè¯†åˆ«è§„åˆ™

### ç›—ç‰ˆç‰¹å¾å…³é”®è¯
- ç½‘ç›˜ã€ç™¾åº¦äº‘ã€é˜¿é‡Œäº‘ç›˜ã€å¤¸å…‹ã€é“¾æ¥ã€æå–ç 
- ç”µå­ç‰ˆã€PDFã€epubã€éŸ³é¢‘ã€MP3ã€è§†é¢‘
- æ‰“åŒ…ã€å…¨é›†ã€åˆé›†ã€èµ„æºã€ç§å‘ã€ç§’å‘

### æ­£ç‰ˆäºŒæ‰‹ç‰¹å¾
- äºŒæ‰‹ã€é—²ç½®ã€è½¬è®©ã€å®ä½“ä¹¦ã€çº¸è´¨ã€æ­£ç‰ˆ
- ä¹æˆæ–°ã€å…«æˆæ–°ã€åŒ…é‚®ã€è‡ªæ

### åˆ¤å®šé€»è¾‘
- **é«˜ç½®ä¿¡åº¦ç›—ç‰ˆ**: ä»…æ£€æµ‹åˆ°ç›—ç‰ˆç‰¹å¾ï¼Œç½®ä¿¡åº¦ > 60%
- **å¯ç–‘å†…å®¹**: åŒæ—¶å­˜åœ¨ç›—ç‰ˆå’Œæ­£ç‰ˆç‰¹å¾ï¼Œéœ€äººå·¥ç¡®è®¤
- **æ­£ç‰ˆäºŒæ‰‹**: ä»…æ£€æµ‹åˆ°æ­£ç‰ˆç‰¹å¾

## æ£€æµ‹æŠ¥å‘Š

ç¨‹åºè¿è¡Œå®Œæˆåè‡ªåŠ¨ç”ŸæˆJSONæ ¼å¼æŠ¥å‘Šï¼š

```json
{
  "summary": {
    "platform": "xianyu",
    "checked": 10,
    "piracy_found": 3,
    "reported": 2
  },
  "records": [
    {
      "time": "2024-12-27T15:30:00",
      "title": "å¾—åˆ°ç”µå­ä¹¦å…¨é›†PDF",
      "price": "9.9",
      "is_piracy": true,
      "confidence": 0.85,
      "reasoning": "æ£€æµ‹åˆ°3é¡¹ç›—ç‰ˆç‰¹å¾",
      "reported": true
    }
  ]
}
```

## æŠ€æœ¯æ¶æ„è¯´æ˜

### PhoneAgentæ ¸å¿ƒå¾ªç¯

```mermaid
stateDiagram-v2
    [*] --> åˆå§‹åŒ–
    åˆå§‹åŒ– --> æˆªå›¾: å¼€å§‹ä»»åŠ¡
    æˆªå›¾ --> æ¨¡å‹æ¨ç†: å‘é€æˆªå›¾+ä¸Šä¸‹æ–‡
    æ¨¡å‹æ¨ç† --> è§£æåŠ¨ä½œ: è¿”å›thinking+action
    è§£æåŠ¨ä½œ --> æ‰§è¡ŒåŠ¨ä½œ: è§£ææˆåŠŸ
    è§£æåŠ¨ä½œ --> ç»“æŸ: è§£æå¤±è´¥
    æ‰§è¡ŒåŠ¨ä½œ --> æˆªå›¾: æœªå®Œæˆ
    æ‰§è¡ŒåŠ¨ä½œ --> ç»“æŸ: ä»»åŠ¡å®Œæˆ
    ç»“æŸ --> [*]
```

### æ”¯æŒçš„æ“ä½œæŒ‡ä»¤

| æŒ‡ä»¤ | è¯´æ˜ | ç¤ºä¾‹ |
|------|------|------|
| `Launch` | å¯åŠ¨åº”ç”¨ | `do(action="Launch", app="é—²é±¼")` |
| `Tap` | ç‚¹å‡»åæ ‡ | `do(action="Tap", element=[500,500])` |
| `Type` | è¾“å…¥æ–‡æœ¬ | `do(action="Type", text="æœç´¢å†…å®¹")` |
| `Swipe` | æ»‘åŠ¨æ‰‹åŠ¿ | `do(action="Swipe", start=[500,800], end=[500,200])` |
| `Back` | è¿”å› | `do(action="Back")` |
| `Home` | ä¸»å±å¹• | `do(action="Home")` |
| `Wait` | ç­‰å¾… | `do(action="Wait", duration="2 seconds")` |
| `finish` | å®Œæˆä»»åŠ¡ | `finish(message="ä»»åŠ¡å®Œæˆ")` |

## æ³¨æ„äº‹é¡¹

1. **è®¾å¤‡å‡†å¤‡**: ç¡®ä¿æ¨¡æ‹Ÿå™¨/æ‰‹æœºå·²å®‰è£…ç›®æ ‡App(å¾—åˆ°ã€é—²é±¼ã€å°çº¢ä¹¦)å¹¶å·²ç™»å½•
2. **ç½‘ç»œç¯å¢ƒ**: éœ€è¦ç¨³å®šçš„ç½‘ç»œè¿æ¥è®¿é—®AIæ¨¡å‹API
3. **æ“ä½œå»¶æ—¶**: ä¸åŒè®¾å¤‡æ€§èƒ½å¯èƒ½å¯¼è‡´æ“ä½œå»¶æ—¶å·®å¼‚ï¼Œå¯åœ¨`config/timing.py`è°ƒæ•´
4. **æ•æ„Ÿæ“ä½œ**: æ¶‰åŠæ”¯ä»˜ã€éšç§ç­‰æ•æ„Ÿæ“ä½œæ—¶ä¼šè¯·æ±‚ç”¨æˆ·ç¡®è®¤
5. **ä¸¾æŠ¥è´£ä»»**: è‡ªåŠ¨ä¸¾æŠ¥åŠŸèƒ½è¯·è°¨æ…ä½¿ç”¨ï¼Œç¡®ä¿å†…å®¹ç¡®å®ä¾µæƒ

## License

MIT License
